#' @title getPhyloTree
#' 
#' @import phangorn
#' @param a Maf object generated by readMaf function
#' @param method Approach to construct phylogenetic trees.Choose one of "NJ"(Neibor-Joining),"MP"(maximum parsimony),"ML"(maximum likelihood),""FASTME.ols" or "FASTME.bal". 
#' @param min.vaf the minimum value of vaf
#' @param max.vaf the maximum value of vaf
#' @param min.CCF the minimum value of CCF
#' @param bootstrap.rep.num bootstrap iterations.
#' @param patient.id select the specific patients. Default: NULL, all patients are included.
#' 
#' 
#' @examples
#' maf.File <- system.file("extdata", "HCC6046.maf", package = "MesKit")
#' ccf.File <- system.file("extdata", "HCC6046.CCF.txt", package = "MesKit")
#' maf <- readMaf(mafFile=maf.File, refBuild="hg19")
#' njtree <- getPhyloTree(maf)
#' @return  a list of class PhyloTree
#' @exportClass phyloTree
#' @export getPhyloTree


# set NJtree object
getPhyloTree <- function(maf, 
                      method = "NJ",
                      min.vaf = 0.02, 
                      min.CCF = NULL,
                      bootstrap.rep.num = 100,
                      patient.id = NULL){
  
  method.options <- c("NJ","MP","ML","FASTME.ols","FASTME.bal")
  if(!method %in% method.options){
      stop("method can only be either 'NJ','ML' or 'MP','FASTME.ols','FASTME.bal'")
  }
  
  if(min.vaf < 0){
      stop("Error: min.vaf must be greater than 0")
  }
  
  maf.dat <- maf@data
  if(!is.null(patient.id)){
      patient.setdiff <- setdiff(patient.id, unique(maf.dat$Patient_ID))
      if(length(patient.setdiff) > 0){
          stop(paste0(patient.setdiff, " can not be found in your data"))
      }
      maf.dat <- maf.dat[maf.dat$Patient_ID %in% patient.id] 
  }
  
  refBuild <- maf@ref.build
  maf.dat$Patient_ID <- as.character(maf.dat$Patient_ID)
  dat.list <- split(maf.dat, maf.dat$Patient_ID)
  phyloTree.list <- list()
  phyloTree.list <- lapply(dat.list, doGetPhyloTree,
                           refBuild = refBuild,
                           method = method,
                           min.vaf = min.vaf,
                           min.CCF = min.CCF,
                           bootstrap.rep.num = bootstrap.rep.num)
  return(phyloTree.list)
}