#' @title plotPhyloTree
#' 
#' @param phyloTree a phyloTree object generated by getphyloTree function.
#' @param branchCol character."mutSig" for colouring branches by mutation signature;"mutType" for colouring branches by branch tumor type;NULL for colouring automatically.Default is 'mutSig'.
#' @param show.heatmap logical. Whether to show heatmap of somatic mutations. Default is TRUE.
#' @param heatmap.type character. "binary" (default) for printing a binary heatmap of mutations; or "CCF" for printing a cancer cell frequency (CCF) heatmap. This parameter is only useful when branchCol = "mutSig".
#' @param show.class.label logical. If TRUE, show labels for mutations classes on the heatmap.Default is FALSE.
#' @param show.bootstrap logical.Whether to add bootstrap value on internal nodes.Default is TRUE.
#' @param use.box logical.Whether to add box around bootstrap value on tree. Default is TRUE.
#' @param min.ratio double (Default:1/30). If min.ratio is not NULL,
#'  all edge length of a phylogenetic tree should be greater than
#'  min.ratio*the longest edge length.
#'  If not, the edge length will be reset as min.ratio*longest edge length.
#' @param patient.id select the specific patients. Default: NULL, all patients are included
#' @param geneList list of genes to restrict the analysis. Default NULL.
#' @param plot.geneList if TRUE, plot heatmap with genes on geneList when geneList is not NULL.Default FALSE.
#' @param show.gene show the name of genes next to the heatmap.Default FALSE.
#' @param show.geneList show the names of gene on the geneList.Default FALSE.
#' @param mut.threshold show.gene and show.geneList will be FALSE when patient have more mutations than threshold.Default is 150.
#' 
#' 
#' @examples
#' plotPhyloTree(phyloTree)
#' ## Use CCF 
#' plotPhyloTree(phyloTree, heatmap.type = 'CCF')
#
#' @return return a list of phylotree graph .
#' @import reshape2 ape ggplot2 ggrepel
#' @export plotPhyloTree
#' 


plotPhyloTree <- function(phyloTree = NULL,
                          branchCol = "mutSig",
                          show.heatmap = TRUE,
                          heatmap.type = 'binary',
                          show.bootstrap = TRUE,
                          use.box = TRUE,
                          min.ratio = 1/30,
                          show.class.label = FALSE,
                          geneList = NULL,
                          plot.geneList = FALSE,
                          show.gene = FALSE,
                          show.geneList = TRUE,
                          mut.threshold = 150,
                          min.mut.count=15,
                          patient.id = NULL){
   heatmap.options <- c('binary','CCF')
   if(!heatmap.type %in% heatmap.options){
      stop("Type of heatmap can only be 'binary' or 'CCF'")
   }
   if(heatmap.type == 'binary'){
     use.ccf = FALSE
   }else if(heatmap.type == 'CCF'){
       use.ccf = TRUE 
   }
   
   branchCol.options <- c("mutSig","mutType")
   if(!is.null(branchCol)){
       if(!branchCol %in% branchCol.options){
           stop("Type of branchCol can only be 'mutSig','mutType' or NULL")
       }
   }
   
   if(!is.null(patient.id)){
       patient.setdiff <- setdiff(patient.id, names(phyloTree))
       if(length(patient.setdiff) > 0){
           stop(paste0(patient.setdiff, " can not be found in your data"))
       }
       phyloTree <- phyloTree[names(phyloTree)  %in% patient.id] 
   }
   tree.list <- lapply(phyloTree, drawPhyloTree,
                       branchCol = branchCol,
                       show.bootstrap = show.bootstrap,
                       use.box = use.box,
                       show.heatmap = show.heatmap,
                       use.ccf = use.ccf,
                       min.ratio = min.ratio,
                       show.class.label = show.class.label,
                       geneList = geneList,
                       plot.geneList = plot.geneList,
                       show.gene = show.gene,
                       show.geneList = show.geneList,
                       mut.threshold = mut.threshold,
                       min.mut.count = min.mut.count)
   return(tree.list)
}