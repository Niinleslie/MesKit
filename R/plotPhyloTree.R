#' @title plotPhyloTree
#' 
#' @param phyloTree phyloTree or phyloTreeList object generated by \code{\link{getPhyloTree}} function.
#' @param patient.id Select the specific patients. Default: NULL, all patients are included.
#' @param branchCol Specify the colors of branches (Default: mutType). Other options: "mutSig" for coloring branches by branch mutation signature;
#' @param show.bootstrap Logical. Whether to add bootstrap value on internal nodes. Default is TRUE.
#' @param min.ratio Double (Default:1/20). If min.ratio is not NULL,
#'  all edge length of a phylogenetic tree should be greater than
#'  min.ratio*the longest edge length.
#'  If not, the edge length will be reset as min.ratio*longest edge length.
#' @param signaturesRef Signature reference,Users can upload their own reference. Default "cosmic_v2". Option:"exome_cosmic_v3","nature2013".
#' @param min.mut.count The threshold for the variants in a branch. Default 15.
#' @param use.Tumor_Label Let Tumor_Sample_Barcode be Tumor_Label if Tumor Label is provided in clinical data.Default FALSE.
#' @examples
#' maf.File <- system.file("extdata/", "HCC_LDC.maf", package = "MesKit")
#' clin.File <- system.file("extdata/", "HCC_LDC.clin.txt", package = "MesKit")
#' ccf.File <- system.file("extdata/", "HCC_LDC.ccf.tsv", package = "MesKit")
#' maf <- readMaf(mafFile=maf.File, ccfFile = ccf.File, refBuild="hg19")
#' 
#' phyloTree <- getPhyloTree(maf, patient.id = 'HCC8257')
#' plotPhyloTree(phyloTree)
#
#' @return return a list of phylotree graph .
#' @import ape ggplot2 ggrepel
#' @export plotPhyloTree
#' 


plotPhyloTree <- function(phyloTree,
                          patient.id = NULL,
                          branchCol = "mutType",
                          show.bootstrap = TRUE,
                          min.ratio = 1/20,
                          signaturesRef = "cosmic_v2",
                          min.mut.count = 15,
                          use.Tumor_Label = FALSE){
   
   if(!is.null(branchCol)){
       branchCol.options <- c("mutSig","mutType")
       if(!branchCol %in% branchCol.options){
           stop("Error: branchCol can only be NULL, 'mutType' or 'mutSig'.")
       }
   }
    ## check input data
    phyloTree_list <- checkPhyloTreeInput(phyloTree,patient.id = patient.id)
    
    processPlotTree <- function(phyloTree){
       patient <- getPhyloTreePatient(phyloTree)
       p <- plotTree(phyloTree,
                     branchCol = branchCol,
                     show.bootstrap = show.bootstrap,
                     signaturesRef = signaturesRef,
                     min.mut.count = min.mut.count,
                     use.Tumor_Label = use.Tumor_Label)
       return(p)
    }
   
   tree_list <- lapply(phyloTree_list, processPlotTree)
   tree_list <- tree_list[!is.na(tree_list)]
   
   if(length(tree_list)==1){
       return(tree_list[[1]])
   }else if(length(tree_list) == 0){
       return(NA)
   }else{
       return(tree_list)
   }
}