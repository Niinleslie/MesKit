#' @title mutHeatmap
#' @description plot the corresponding binary heatmap or ccf heatmaf of the phyloTree
#'
#' @param maf Maf object generated by readMaf function
#' @param use.ccf logical. If FALSE (default), print a binary heatmap of mutations. Otherwise, print a cancer cell frequency (CCF) heatmap.
#' @param show.class.label logical. If TRUE, show labels for mutations classes on the heatmap.Default is TRUE.
#' @param patient.id select the specific patients. Default: NULL, all patients are included.
#' @param geneList list of genes to restrict the analysis. Default NULL.
#' @param plot.geneList if TRUE, plot heatmap with genes on geneList when geneList is not NULL.Default FALSE.
#' @param show.gene show the name of genes next to the heatmap.Default FALSE.
#' @param show.geneList show the names of gene on the geneList.Default FALSE.
#' @param mut.threshold show.gene and show.geneList will be FALSE when patient have more mutations than threshold.Default is 150.
#' 
#' @return heatmap of somatic mutations
#'
#'
#' @examples
#' mutHeatmap(phyloTree)
#' mutHeatmap(phyloTree, use.ccf = TRUE)
#'
#' @export mutHeatmap

mutHeatmap <- function(maf,
                        use.ccf = FALSE,
                        show.class.label = TRUE,
                        geneList = NULL,
                        plot.geneList = FALSE,
                        show.gene = FALSE,
                        show.geneList = TRUE,
                        patient.id = NULL,
                       mut.threshold = 50){
    mafData <- maf@data
    mafData$Patient_ID <- as.character(mafData$Patient_ID)
    

    
    ## select the specificed patient
    if(!is.null(patient.id)){
        patient.setdiff <- setdiff(patient.id, unique(mafData$Patient_ID))
        if(length(patient.setdiff) > 0){
            stop(paste0(patient.setdiff, " can not be found in your data"))
        }
        mafData <- mafData[Patient_ID %in% patient.id,]
    }
    
    
    
    ## split data by patients
    dat.list <- split(mafData, mafData$Patient_ID)
    
    ## get mutation matrix
    matrix.list <- lapply(dat.list, getHeatmapMatrix)
    
    ## plot heatmap
    heatmap.list <- lapply(matrix.list,function(x,
                                                use.ccf,
                                                show.class.label,
                                                geneList,
                                                plot.geneList,
                                                show.gene,
                                                show.geneList,
                                                mut.threshold){
        binary.mat <- x[[1]]
        ccf.mat <- x[[2]]
        patient <- x[[3]]
        p <- plotHeatmap(binary.mat = binary.mat,
                        ccf.mat = ccf.mat,
                        use.ccf = use.ccf,
                        show.class.label = show.class.label,
                        geneList = geneList,
                        plot.geneList = plot.geneList,
                        show.gene = show.gene,
                        show.geneList = show.geneList,
                        mut.threshold = mut.threshold,
                        plot.tree = FALSE,
                        patient = patient)
    },
    use.ccf = use.ccf,
    show.class.label = show.class.label,
    geneList = geneList,
    plot.geneList = plot.geneList,
    show.gene = show.gene,
    show.geneList = show.geneList,
    mut.threshold = mut.threshold)
    
    return(heatmap.list)
}