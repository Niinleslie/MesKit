#' @title treeGO
#' @description Perform GO enrichment analysis of trunk/branch mutations of a phylogenetic tree.
#' 
#' 
#' @param phyloTree a phyloTree object generated by getPhyloTree function
#' @param geneList list of genes to restrict the analysis. Default NULL.
#' @param GO.type one of "BP", "MF", and "CC" sub-ontologies, 
#' or "ALL" for pooling 3 GO sub-ontologies. Default is "ALL"
#' @param pval cutoff value of pvalue. Default pval=0.05
#' @param pAdjustMethod one of "holm", "hochberg", "hommel", "bonferroni", "BH", "BY", "fdr", "none".
#' Default is "BH"
#' @param qval cutoff value of qvalue. Default qval=0.2
#' @param plotType one of "dot", "bar", default is "dot"
#' @param showCategory number of categories will be shown, default is 5
#' @param patient.id select the specific patients. Default: NULL, all patients are included

#' 
#' 
#' @examples 
#' treeGO(phyloTree, GO.type = "BP")
#' @return GO enrichment results
#' @import clusterProfiler pdp
#' @export treeGO

treeGO <- function(phyloTree,
                   geneList = NULL,
                   GO.type="BP",
                   pval=0.05,
                   pAdjustMethod="BH", 
                   qval=0.2,
                   plotType="dot",
                   showCategory=5,
                   withinType = FALSE,
                   patient.id = NULL){
  
  if(!is.null(patient.id)){
        patient.setdiff <- setdiff(patient.id, names(phyloTree))
        if(length(patient.setdiff) > 0){
            stop(paste0(patient.setdiff, " can not be found in your data"))
        }
        phyloTree <- phyloTree[names(phyloTree)  %in% patient.id] 
  }
  GO.options = c('MF', 'BP', 'CC', "ALL")
    if(!GO.type %in% GO.options){
        stop("GO.type can only be either 'MF', 'BP' 'CC' or 'ALL'")
    }
  selectedGenes <- NULL
  if(!is.null(geneList)){
      selectedGenes <- geneList
  }
  result.list <- suppressWarnings(lapply(phyloTree,doTreeGO,
                        selectedGenes = selectedGenes,
                        GO.type = GO.type,                     
                        pval= pval,
                        pAdjustMethod= pAdjustMethod, 
                        qval= qval,
                        plotType= plotType,
                        withinType = withinType,
                        showCategory= showCategory)) 
}