#' @title compareCCF
#' @description Density plot of CCFs in paired samples of the patient
#' This function requires CCF for clustering
#' @param maf a Maf object generated by readMaf function.
#' @param patient.id select the specific patients. Default: NULL, all patients are included
#' @param min.ccf the minimum value of CCF. Default: 0
#' @param pairByType pair by tumor types in each patients,default is FALSE.
#' @param geneList list of genes to restrict the analysis. Default NULL.
#' 
#' 
#' @return
#' @examples
#' compareCCF(maf)
#' @export compareCCF


compareCCF <- function(maf,
                    patient.id = NULL,
                    pairByType = FALSE,
                    geneList = NULL,
                    min.ccf = 0){
  mafData <- maf@data

  ## check if ccf data is provided
  if(! "CCF" %in% colnames(mafData)){
    stop(paste0("ccfDensity function requires CCF data.\n",
    "No CCF data was found when generate Maf object."))
  }

  if(min.ccf < 0){
      stop("Error: min.ccf must be greater than 0")
  }
  
  if(is.null(patient.id)){
      
      patient.id = unique(mafData$Patient_ID)
  
  }else{
      patient.setdiff <- setdiff(patient.id, unique(mafData$Patient_ID))
      if(length(patient.setdiff) > 0){
          stop(paste0("Patient ", patient.setdiff, " can not be found in your data"))
      }
      mafData <- mafData[Patient_ID %in% patient.id,]
  
  }

  
  density.list <- mafData %>%
      dplyr::filter(Patient_ID %in% patient.id & CCF > min.ccf) %>%
      dplyr::group_by(Patient_ID) %>%
      dplyr::group_map(., ~ccfPair(.x, pairByType = pairByType, geneList = geneList), keep=TRUE) %>%
      rlang::set_names(patient.id)

  return(density.list)      
}
